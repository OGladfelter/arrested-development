<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>

        

        <meta charset="utf-8">
        <link rel="shortcut icon" href="#">
        <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans">
        <link rel = "stylesheet"
            type = "text/css"
            href = "css/style.css" />

        <!-- <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script> -->
        <script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
        <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script> -->
    </head>

    <style>

        .link {
          stroke: darkgrey;
        }
        
        .node text {
          pointer-events: none;
          font: 20px sans-serif;
        }

        img {
            border-radius: 50%;
        }

        .tooltip {
            position: absolute;
            z-index: 10;
            visibility: hidden;
            background-color: black;
            text-align: center;
            padding: 4px;
            border-radius: 4px;
            /*font-weight: bold;*/
            color: white;
            font-size: 15px;
        }
        
        </style>
        <body>
            <h1 id="valueHeader">Value: </h1>
        <script src="//d3js.org/d3.v3.min.js"></script>
        <script>
        
        var width = 960,
            height = 500
        
        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);
        
        var force = d3.layout.force()
            .gravity(0.04)
            .distance(300)
            .charge(-200)
            .size([width, height]);

        var drag = force.drag()
            .on("dragstart", dragstart);

        d3.json("data.json", function(error, json) {
          if (error) throw error;
        
          force
              .nodes(json.nodes)
              .links(json.links)
              .start();
        
            

          var link = svg.selectAll(".link")
            .data(json.links)
            .enter().append("line")
            .attr("class", "link")
            .style("opacity","0.8")
            .style("stroke-width", function(d){return  Math.sqrt(d.value)})
            .on("mouseover", function(d){
                svg.selectAll(".link").style("stroke","lightgray")
                svg.selectAll(".link").style("opacity","0.3")
                d3.select(this).style("stroke","#FF4D11")
                d3.select(this).style("opacity","1")
                document.getElementById("valueHeader").innerHTML = "Value: " + d.value;
            })
            .on("mouseout", function(d){
                svg.selectAll(".link").style("stroke","darkgray")
                svg.selectAll(".link").style("opacity","0.8")
                document.getElementById("valueHeader").innerHTML = "Value: ";
            });
        
          var node = svg.selectAll(".node")
              .data(json.nodes)
            .enter().append("g")
              .attr("class", "node")
              .call(force.drag)
              .on("dblclick", dblclick)
                .call(drag);
        
        node
            .on("mouseover", function (d) {
                link.style('stroke', function(l) {
                    if (d === l.source || d === l.target)
                    return "#FF4D11";
                    else
                    return "lightgray";})
                link.style('opacity', function(l) {
                    if (d === l.source || d === l.target)
                    return "1";
                    else
                    return "0.3";})
            })
            .on("mouseout", function () {
                link.style('stroke', "darkgray")
                link.style("opacity", "0.8")
            });

          node.append("image")
              .attr("xlink:href", function(d){return d.picture})
              .attr("x", -32)
              .attr("y", -32)
              .attr("width", 64)
              .attr("height", 64)
              .style("border-radius", "50%");
        
          node.append("text")
              .attr("dx", 0)
              .attr("dy", "2.5em")
              .style('text-anchor', "middle")
              .text(function(d) { return d.name });
        
          force.on("tick", function() {
            link.attr("x1", function(d) { return d.source.x; })
                .attr("y1", function(d) { return d.source.y; })
                .attr("x2", function(d) { return d.target.x; })
                .attr("y2", function(d) { return d.target.y; });
        
            node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
          });
        });

        function dblclick(d) {
            d3.select(this).classed("fixed", d.fixed = false);
        }

        function dragstart(d) {
            d3.select(this).classed("fixed", d.fixed = true);
        }
        
        </script>
</html>